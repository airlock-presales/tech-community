apiVersion: microgateway.airlock.com/v1alpha1
kind: AccessControlPolicy
metadata:
  name: api
  namespace: api
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: api
  policies:
    - requestConditions:
        path:
          matcher:
            regex: ^/
      identityPropagation:
        actions:
          - identityPropagationRef:
              name: api
        onFailure: Pass
      authorization:
        authentication:
          jwt:
            jwtRef:
              name: api
      tokenExchange:
        onFailure: Block
        actions:
          - tokenExchangeRef:
              name: hearst
    - authorization: {}
